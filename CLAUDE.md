# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Build & Dev Commands

```bash
npm run tauri dev      # Full app dev mode (Vite + Rust hot reload)
npm run tauri build    # Production build (runs vue-tsc --noEmit first)
npm run build          # Frontend only: type-check + vite build
cargo check            # Type-check Rust code (run from src-tauri/)
vue-tsc --noEmit       # Type-check frontend
```

## Architecture

Desklist is a Windows desktop memo/reminder app built with Tauri 2 + Vue 3 + TypeScript. It runs as a frameless, transparent, always-on-top window (360×520) that minimizes to the system tray instead of closing.

### Data flow split

- **Frontend (Vue)** handles all event CRUD directly via `@tauri-apps/plugin-sql` JavaScript API — no Tauri IPC commands for data operations.
- **Rust backend** handles system integration only: reminder scheduler, tray icon, single-instance enforcement, close-to-tray behavior.

### Reminder scheduler (Rust)

`scheduler.rs` runs a background async loop polling every 30 seconds. It accesses the same SQLite database by reaching into `tauri_plugin_sql::DbInstances` state and pattern-matching `DbPool::Sqlite(pool)` to get the raw sqlx pool. This avoids opening a second DB connection.

### Database

SQLite via `tauri-plugin-sql`, database URI: `sqlite:desklist.db`. Migrations are embedded via `include_str!` in `db.rs` and registered through `tauri_plugin_sql::Builder::add_migrations()`.

Two tables: `events` (main data) and `reminder_queue` (scheduled notification triggers with `fired` flag). Reminder queue rows are generated by the frontend composable when creating/updating events.

### Frontend structure

- `composables/useEvents.ts` — all DB queries and business logic (CRUD, filter queries, recurring event generation, reminder queue management)
- `components/EventList.vue` — main view with tab filtering (今天/即将/已完成/全部)
- `components/EventForm.vue` — slide-in create/edit panel
- `components/TitleBar.vue` — custom draggable title bar using `data-tauri-drag-region`
- `types/index.ts` — `DeskEvent`, `ReminderRecord`, `FilterTab` interfaces

### Rust modules

- `lib.rs` — Tauri builder, plugin registration, close-to-tray setup
- `tray.rs` — system tray menu and click handlers
- `scheduler.rs` — background reminder polling + notification dispatch
- `db.rs` — migration definitions

## Key Details

- UI language is Chinese (zh-CN)
- Window hides to tray on both minimize and close (never truly closes from UI)
- Recurring events: completing one auto-generates the next occurrence
- No IPC commands defined — frontend talks to SQLite directly via the sql plugin's JS API
- Capabilities are in `src-tauri/capabilities/default.json`
- Tauri plugins config is intentionally empty in `tauri.conf.json` (`"plugins": {}`) — sql preload is configured in Rust
